#!/bin/sh
set -e

# Heimdall launcher script
# Finds and executes the appropriate opencode binary with Heimdall branding

# Set Heimdall environment variables
export OPENCODE_NAME="heimdall"
export OPENCODE_BRAND="Heimdall"

# Get the real path of this script
script_path="$0"
while [ -L "$script_path" ]; do
    link_target="$(readlink "$script_path")"
    case "$link_target" in
        /*) script_path="$link_target" ;;
        *) script_path="$(dirname "$script_path")/$link_target" ;;
    esac
done
script_dir="$(dirname "$script_path")"
script_dir="$(cd "$script_dir" && pwd)"

# Path to vendored opencode
vendor_bin="$script_dir/../vendor/opencode/packages/opencode/bin/opencode"

if [ -f "$vendor_bin" ]; then
    # Execute the vendored opencode with all arguments
    exec "$vendor_bin" "$@"
else
    echo "Error: Could not find vendored opencode binary" >&2
    echo "Please run 'bun install' first to set up dependencies" >&2
    exit 1
fi
#!/usr/bin/env bash
# Simplified Heimdall launcher for testing

# Set environment
export HEIMDALL_VERSION="0.1.0"

# Display branding
if [[ "$*" == *"--help"* ]] || [ $# -eq 0 ]; then
  echo "
╦ ╦╔═╗╦╔╦╗╔╦╗╔═╗╦  ╦  
╠═╣║╣ ║║║║ ║║╠═╣║  ║  
╩ ╩╚═╝╩╩ ╩═╩╝╩ ╩╩═╝╩═╝

Heimdall v$HEIMDALL_VERSION - AI-powered CLI assistant
"
fi

# Apply patches if they exist
if [ -f "$(dirname "$0")/../patches/001-heimdall-branding.patch" ]; then
  # Check if patches are already applied
  if ! grep -q "heimdall" vendor/opencode/packages/opencode/src/index.ts 2>/dev/null; then
    echo "[Heimdall] Applying patches..."
    git apply patches/001-heimdall-branding.patch 2>/dev/null || true
  fi
fi

# Run opencode with our branding
cd "$(dirname "$0")/../vendor/opencode" && \
  bun run --conditions=development packages/opencode/src/index.ts "$@"
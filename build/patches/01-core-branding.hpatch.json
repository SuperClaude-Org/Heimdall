{
  "version": "1.0",
  "name": "core-branding",
  "description": "Core system identifiers and package naming for Heimdall branding",
  "compatibility": {
    "opencode": ">=0.5.0",
    "test_command": "bun test"
  },
  "patches": [
    {
      "id": "package-name-update",
      "description": "Update package.json name from opencode to heimdall",
      "files": ["fork/opencode/packages/opencode/package.json"],
      "changes": [
        {
          "strategy": "replace",
          "matchers": [
            {"type": "exact", "pattern": "\"name\": \"opencode\""},
            {"type": "fuzzy", "pattern": "\"name\": \"opencode\"", "confidence_threshold": 0.95}
          ],
          "replacement": "\"name\": \"heimdall\"",
          "all_occurrences": false
        }
      ]
    },
    {
      "id": "binary-references",
      "description": "Update binary file references to use heimdall naming",
      "files": ["fork/opencode/packages/opencode/bin/opencode"],
      "changes": [
        {
          "strategy": "replace",
          "matchers": [
            {"type": "exact", "pattern": "OPENCODE_BIN_PATH"},
            {"type": "fuzzy", "pattern": "OPENCODE_BIN_PATH", "confidence_threshold": 0.9}
          ],
          "replacement": "HEIMDALL_BIN_PATH",
          "all_occurrences": true
        },
        {
          "strategy": "replace",
          "matchers": [
            {"type": "exact", "pattern": "name=\"opencode-${platform}-${arch}\""},
            {"type": "fuzzy", "pattern": "opencode-${platform}-${arch}", "confidence_threshold": 0.8}
          ],
          "replacement": "name=\"heimdall-${platform}-${arch}\"",
          "all_occurrences": false
        },
        {
          "strategy": "replace",
          "matchers": [
            {"type": "exact", "pattern": "binary=\"opencode\""},
            {"type": "fuzzy", "pattern": "binary=\"opencode\"", "confidence_threshold": 0.9}
          ],
          "replacement": "binary=\"heimdall\"",
          "all_occurrences": false
        },
        {
          "strategy": "replace",
          "matchers": [
            {"type": "exact", "pattern": "binary=\"opencode.exe\""},
            {"type": "fuzzy", "pattern": "opencode.exe", "confidence_threshold": 0.9}
          ],
          "replacement": "binary=\"heimdall.exe\"",
          "all_occurrences": false
        }
      ]
    },
    {
      "id": "server-imports",
      "description": "Add core server imports for Heimdall",
      "files": ["fork/opencode/packages/opencode/src/server/server.ts"],
      "changes": [
        {
          "strategy": "inject_after",
          "matchers": [
            {"type": "context", "context": "last_import", "pattern": ""},
            {"type": "exact", "pattern": "import { Auth } from \"../auth\""},
            {"type": "fuzzy", "pattern": "import.*Agent.*from.*agent", "confidence_threshold": 0.7}
          ],
          "content": "import { Installation } from \"../installation\""
        }
      ]
    }
  ]
}